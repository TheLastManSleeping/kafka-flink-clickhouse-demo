

# Real-Time Data Pipeline: Kafka ‚ûî Flink ‚ûî ClickHouse

–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π, –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤—ã–π –∫–æ–Ω–≤–µ–π–µ—Ä –¥–ª—è –ø–æ—Ç–æ–∫–æ–≤–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö. –°–æ–±—ã—Ç–∏—è –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è, –ø–æ—Å—Ç—É–ø–∞—é—Ç –≤ Apache Kafka, —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∏—Ä—É—é—Ç—Å—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ —Å –ø–æ–º–æ—â—å—é Apache Flink –∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫—É—é –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö ClickHouse.

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ –ø–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö

–°–∏—Å—Ç–µ–º–∞ —Ä–µ–∞–ª–∏–∑—É–µ—Ç –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π ETL-–ø—Ä–æ—Ü–µ—Å—Å (Extract, Transform, Load) –≤ –ø–æ—Ç–æ–∫–æ–≤–æ–º —Ä–µ–∂–∏–º–µ.

`[Event Emitter]` ‚ûî `[Kafka (—Å—ã—Ä—ã–µ —Ç–æ–ø–∏–∫–∏)]` ‚ûî `[Flink]` ‚ûî `[Kafka (—á–∏—Å—Ç—ã–π —Ç–æ–ø–∏–∫)]` ‚ûî `[ClickHouse]`

1.  **Event Emitter**: –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç "—Å—ã—Ä—ã–µ" —Å–æ–±—ã—Ç–∏—è –≤ —Ç—Ä–∏ —Ä–∞–∑–Ω—ã—Ö —Ç–æ–ø–∏–∫–∞ Kafka.
2.  **Apache Flink**: –í—ã–ø–æ–ª–Ω—è–µ—Ç **–æ–¥–Ω–æ** ETL-–∑–∞–¥–∞–Ω–∏–µ ‚Äî —á–∏—Ç–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ —Ç—Ä–µ—Ö "—Å—ã—Ä—ã—Ö" —Ç–æ–ø–∏–∫–æ–≤, –æ–±—ä–µ–¥–∏–Ω—è–µ—Ç –∏—Ö –≤ –µ–¥–∏–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≤ –æ–¥–∏–Ω "—á–∏—Å—Ç—ã–π" —Ç–æ–ø–∏–∫ `processed_events`.
3.  **ClickHouse**: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–≤–æ–π –Ω–∞–¥–µ–∂–Ω—ã–π, –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π `Kafka Engine` –¥–ª—è —á—Ç–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –∏–∑ —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ —Ç–æ–ø–∏–∫–∞ `processed_events` –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏—Ö –≤ —Ç–∞–±–ª–∏—Ü—É.

-----

## –ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

  * **–ü–æ—Ç–æ–∫–æ–≤—ã–π ETL**: –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ —Å –ø–æ–º–æ—â—å—é Flink SQL.
  * **–û—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å**: –ù–∞—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –º–µ—Ö–∞–Ω–∏–∑–º —á–µ–∫–ø–æ–∏–Ω—Ç–∏–Ω–≥–∞ –≤–æ Flink –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –ø–æ—Å–ª–µ —Å–±–æ–µ–≤.
  * **–ü–æ–ª–Ω–∞—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è**: –ö–∞—Å—Ç–æ–º–Ω—ã–π –æ–±—Ä–∞–∑ Flink –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∫–∞—á–∏–≤–∞–µ—Ç –≤—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –ø—Ä–∏ —Å–±–æ—Ä–∫–µ.
  * **–ì–∏–±–∫–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è**: –ö–ª—é—á–µ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤—ã–Ω–µ—Å–µ–Ω—ã –≤ `docker-compose.yml`.

-----

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
.
‚îú‚îÄ‚îÄ docker-compose.yml      # –ì–ª–∞–≤–Ω—ã–π —Ñ–∞–π–ª, –æ–ø–∏—Å—ã–≤–∞—é—â–∏–π –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã
‚îú‚îÄ‚îÄ kafka-entrypoint.sh     # –°–∫—Ä–∏–ø—Ç –¥–ª—è –∞–≤—Ç–æ-–≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ CLUSTER_ID –¥–ª—è Kafka            
‚îÇ
‚îú‚îÄ‚îÄ clickhouse_init/
‚îÇ   ‚îî‚îÄ‚îÄ init.sql          # SQL-—Å—Ö–µ–º–∞ –¥–ª—è ClickHouse
‚îÇ
‚îú‚îÄ‚îÄ emitter/                # –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞ —Å–æ–±—ã—Ç–∏–π
‚îÇ   ‚îú‚îÄ‚îÄ Dockerfile
‚îÇ   ‚îú‚îÄ‚îÄ emitter.py
‚îÇ   ‚îî‚îÄ‚îÄ requirements.txt
‚îÇ
‚îî‚îÄ‚îÄ flink/
    ‚îú‚îÄ‚îÄ Dockerfile          # Dockerfile –¥–ª—è —Å–±–æ—Ä–∫–∏ –∫–∞—Å—Ç–æ–º–Ω–æ–≥–æ –æ–±—Ä–∞–∑–∞ Flink
    ‚îî‚îÄ‚îÄ sql/
        ‚îî‚îÄ‚îÄ job.sql       # SQL-—Å–∫—Ä–∏–ø—Ç –¥–ª—è Flink

```

-----

## üöÄ –ö–∞–∫ –∑–∞–ø—É—Å—Ç–∏—Ç—å

1.  –°–∫–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:
    ```bash
    git clone https://github.com/TheLastManSleeping/kafka-flink-clickhouse-demo.git
    ```
2.  –ó–∞–ø—É—Å—Ç–∏—Ç–µ –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã:
    
    ```bash
    docker compose up -d --build
    ```

  
    –°–±–æ—Ä–∫–∞ –∫–∞—Å—Ç–æ–º–Ω–æ–≥–æ –æ–±—Ä–∞–∑–∞ Flink –≤ –ø–µ—Ä–≤—ã–π —Ä–∞–∑ –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–∏–Ω—É—Ç.


-----

## –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏

1.  **–°—Ç–∞—Ç—É—Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤**: –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã –∑–∞–ø—É—â–µ–Ω—ã.

    ```bash
    docker compose ps
    ```

2.  **Flink Web UI**: –û—Ç–∫—Ä–æ–π—Ç–µ **[http://localhost:8081](https://www.google.com/search?q=http://localhost:8081)**. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ Running Jobs -> –Ω–∞–∂–º–∏—Ç–µ –Ω–∞ —Ç–∞—Å–∫ -> –≤—ã–±–µ—Ä–∏—Ç–µ Metrics -> —Å–æ–∑–¥–∞–π—Ç–µ –º–µ—Ç—Ä–∏–∫—É numRecordsOut. –ï—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ –∏–∑–º–µ–Ω—è—é—Ç—Å—è —Å–æ –≤—Ä–µ–º–µ–Ω–µ–º - –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç

3.  **–î–∞–Ω–Ω—ã–µ –≤ ClickHouse**: –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ ClickHouse –∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –¥–∞–Ω–Ω—ã–µ –ø–æ—Å—Ç—É–ø–∞—é—Ç.

    ```bash
    docker compose exec clickhouse-server clickhouse-client
    ```

    –í–Ω—É—Ç—Ä–∏ –∫–ª–∏–µ–Ω—Ç–∞ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –∑–∞–ø—Ä–æ—Å (—Å–¥–µ–ª–∞–π—Ç–µ —ç—Ç–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å —Ä–æ—Å—Ç):

    ```sql
    SELECT count() FROM events_processed;
    ```

-----


## –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞

  * –î–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ –∏ —É–¥–∞–ª–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤:
    ```bash
    docker compose down
    ```
